#!/bin/bash
###############################################################################
#
# This script must be run after bin/build-env. This will use the base
# environment image created by that script as a base, and then apply the
# current version of the source code and tests on top of it, using
# dev-Dockerfile. The tests will then be run, allowing for more rapid
# iteration.
#
# Adapted from SwotRepr: 2020-05-07
#
###############################################################################

base_image="sds/var_subsetter_env"
image="sds/var_subsetter_dev"
tag=${1:-latest}


# Look for old version of image and remove
#
old=$(docker images | grep "$image" | grep "$tag" | awk '{print $3}')
if [ ! -z "$old" ]; then
    docker rmi "$old"
fi


# Build the image with updated subsetter.py, pymods and test directories
#
docker build -t ${image}:${tag} --file bin/dev-Dockerfile .

# Run the container
#
docker run --rm ${image} "$@"
